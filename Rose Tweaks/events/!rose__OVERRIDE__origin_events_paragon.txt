namespace = paragon

country_event = { #Little conclusion of first situation
	id = paragon.5020
	title = "paragon.5020.name"
	desc = "paragon.5020.desc"
	picture = GFX_evt_enclave_overlord
	show_sound = event_factions

	is_triggered_only = yes

	trigger = {
	}

	immediate = {
	}

	option = { #Change to Imperial
		name = paragon.5020.a
		custom_tooltip = paragon.5020.a.tt
		hidden_effect = {
			set_origin = origin_legendary_leader_imperial
			ruler = {
				change_variable = {
					which = paragon_origin_story_ruling
					value = 1
				}
			}
			country_event = {
				id = paragon.5021 days = 90
			}
		}
		change_government = {
			authority = auth_imperial
			remove_invalid_civics = yes
		}
	}
	option = { #Stay Dictatorship
		name = paragon.5020.b
		custom_tooltip = paragon.5020.b.tt
		hidden_effect = {
			country_event = {
				id = paragon.5059 days = 3600 random = 3600
			}
			country_event = {
				id = paragon.5058 days = 7200 random = 3600
			}
		}
	}
	after = {
		hidden_effect = {
			set_country_flag = rose_origin_legendary_leader_proclaim
		}
	}
}

country_event = { #UTILITY - ascension launcher failsafe event, for players continuing their old saved games
	id = paragon.5960
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
			has_origin = origin_legendary_leader_dictatorial
			AND = {
				has_country_flag = paragon_origin_reformists_gone
				has_origin = origin_legendary_leader_imperial
			}
		}
		OR = {
			has_finished_psionic_tradition = yes
			has_tradition = tr_cybernetics_finish
			has_country_flag = synthetic_empire
			has_tradition = tr_genetics_finish
			has_tradition = tr_cloning_finish
			has_tradition = tr_purity_finish
			has_tradition = tr_mutation_finish
		}
		NOT = { has_country_flag = luminary_ascension_path }
		exists = ruler
		ruler = { has_leader_flag = paragon_origin_legendary_leader }
		NOT = { has_country_flag = rose_origin_legendary_leader_ascension_failsafe_triggered }
	}

	immediate = {
		country_event = {
			# Change from 7200 (20 years) randomness on top of 10 year base to 720 (2 years) randomness on top of 15 year base
			id = paragon.5201 days = 4800 random = 720 
		}
		set_country_flag = rose_origin_legendary_leader_ascension_failsafe_triggered
	}
}

# Story Chain Enging Speech #
country_event = {
	id = paragon.6035
	title = "paragon.6035.name"
	desc = paragon.6035.desc
	picture = GFX_evt_legendary_leader
	event_window_type = leader_story

	picture_event_data = {
		portrait = owner.ruler
		room = owner
	}

	is_triggered_only = yes

	trigger = {
		exists = ruler
		ruler = { has_leader_flag = paragon_origin_legendary_leader }
		
		# Checks the unifying situation is done and you've had the choice to proclaim
		has_country_flag = rose_origin_legendary_leader_proclaim
		
		# Checks you took the imperial path, the questline is done
		OR = {
			has_origin = origin_legendary_leader_dictatorial
			
			AND = {
				has_origin = origin_legendary_leader_imperial
				has_country_flag = paragon_origin_reformists_gone
			}
		}
		
		# Checks you finished the luminary ascension or have a chosen one trait
		ruler = {
			OR = {
				has_trait = leader_trait_the_apparatus_luminary
				has_trait = leader_trait_the_cybernetic_luminary
				has_trait = leader_trait_the_psionic_luminary
				has_trait = leader_trait_the_synth_luminary
				has_trait = leader_trait_the_genetic_luminary
				has_any_chosen_one_leader_trait = yes
			}
		}
		
		# Prevents failsafe triggering this event more than once
		NOT = { has_country_flag = rose_origin_legendary_leader_ending }
	}

	option = { #Null choice, status quo
		name = paragon.6035.a
	}

	option = { #Become Democratic/Oligarchic (Authoritarian empires can't be democratic, so they will become Oligarchic instead)
		name = paragon.6035.b
		trigger = {
			NOR = {
				is_fanatic_authoritarian = yes
				ruler = { has_trait = leader_trait_legendary_delusional }
			}
		}
		hidden_effect = {
			ruler = {
				if = {
					limit = { has_leader_flag = leader_rift_blocks_death_events }
					remove_leader_flag = leader_rift_blocks_death_events
				}
				else = {
					remove_leader_flag = leader_death_events_blocked
				}
				remove_leader_flag = paragon_origin_legendary_leader
			}
		}
		set_origin = origin_default
		if = {
			limit = {
				has_ethic = ethic_authoritarian
			}
			change_government = {
				authority = auth_oligarchic
				remove_invalid_civics = yes
			}
		}
		else = {
			change_government = {
				authority = auth_democratic
				remove_invalid_civics = yes
			}
			shift_ethic = ethic_egalitarian
		}
		paragon_origin_gain_modifier = yes
		custom_tooltip = paragon.6035.b.tt
	}
	after = {
		hidden_effect = {
			save_event_target_as = this_country
			add_timeline_event = {
				type = timeline_origin_specific
				override_id = timeline_under_one_rule_destiny_fulfilled
				override_tooltip = "TIMELINE_EVENT_LEGENDARY_LEADER_TOOLTIP"
				override_types = { }
				override_text = { "text:TIMELINE_EVENT_LEGENDARY_LEADER" }
				override_texture = { "background:GFX_origin_legendary_leader" }
				targets = { }
			}
			
			set_country_flag = rose_origin_legendary_leader_ending
		}
	}
}
